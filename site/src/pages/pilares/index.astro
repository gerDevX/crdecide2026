---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PillarCard from '../../components/pillars/PillarCard.astro';
import { getAllPillarCardData, candidateIndex } from '../../lib/data';
import { CRITICAL_PILLARS } from '../../lib/types';
import type { PillarId } from '../../lib/types';

const pillarData = getAllPillarCardData();
---

<BaseLayout title="Pilares Nacionales">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-slate-900 mb-2">Los 10 Pilares Nacionales</h1>
      <p class="text-slate-600 max-w-3xl">
        Organizamos las propuestas de cada candidato en 10 áreas temáticas fundamentales para el país.
        Los pilares marcados como "críticos" (P1-P5 y P7) representan el 85% del peso total en la evaluación.
      </p>
    </div>

    <!-- Legend -->
    <div class="flex flex-wrap gap-4 mb-8">
      <div class="flex items-center gap-2 text-sm">
        <span class="w-3 h-3 bg-amber-200 rounded"></span>
        <span class="text-slate-600">Pilar crítico (mayor peso)</span>
      </div>
      <div class="flex items-center gap-2 text-sm">
        <span class="w-3 h-3 bg-slate-200 rounded"></span>
        <span class="text-slate-600">Pilar complementario</span>
      </div>
    </div>

    <!-- Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {pillarData.map((data) => {
        const topCandidate = data.topCandidates[0];
        const isCritical = CRITICAL_PILLARS.includes(data.pillar.pillar_id as PillarId);
        
        return (
          <div class={isCritical ? 'ring-2 ring-amber-200 rounded-xl' : ''}>
            <PillarCard
              pillar={data.pillar}
              avgScore={data.avgScore}
              topCandidate={topCandidate ? {
                name: topCandidate.candidate.party_name.split(' ').slice(0, 2).join(' '),
                score: topCandidate.score.effective_score,
              } : undefined}
            />
          </div>
        );
      })}
    </div>

    <!-- Info -->
    <div class="mt-12 card p-6">
      <h2 class="text-xl font-bold text-slate-900 mb-4">Sobre los pesos (v6)</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h3 class="font-semibold text-slate-800 mb-2">Pilares prioritarios (60%)</h3>
          <ul class="text-sm text-slate-600 space-y-1">
            <li>• P3 Seguridad: 18%</li>
            <li>• P4 Salud: 16%</li>
            <li>• P1 Finanzas: 14%</li>
            <li>• P7 Reforma: 12%</li>
          </ul>
        </div>
        <div>
          <h3 class="font-semibold text-slate-800 mb-2">Pilares críticos adicionales (21%)</h3>
          <ul class="text-sm text-slate-600 space-y-1">
            <li>• P2 Empleo: 11%</li>
            <li>• P5 Educación: 10%</li>
          </ul>
          <h3 class="font-semibold text-slate-800 mb-2 mt-4">Pilares complementarios (19%)</h3>
          <ul class="text-sm text-slate-600 space-y-1">
            <li>• P10 Infraestructura: 9%</li>
            <li>• P8 Social: 5%</li>
            <li>• P6 Ambiente: 3%</li>
            <li>• P9 Exterior: 2%</li>
          </ul>
        </div>
      </div>
    </div>

  </div>
</BaseLayout>

---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PillarCard from '../../components/pillars/PillarCard.astro';
import { getAllPillarCardData, candidateIndex } from '../../lib/data';
import { CRITICAL_PILLARS, PILLAR_ICONS } from '../../lib/types';
import type { PillarId } from '../../lib/types';

const pillarData = getAllPillarCardData();

// Sort pillars by weight for priority display
const sortedByWeight = [...pillarData].sort((a, b) => b.pillar.weight - a.pillar.weight);
---

<BaseLayout title="Pilares Nacionales">
  <div class="pillars-page max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Header -->
    <div class="page-header mb-8">
      <h1 class="page-title text-3xl font-bold text-slate-900 mb-2">Los 10 Pilares Nacionales</h1>
      <p class="page-description text-slate-600 max-w-3xl">
        Organizamos las propuestas de cada candidato en <strong>10 √°reas tem√°ticas</strong> fundamentales para el pa√≠s.
        Los pilares marcados como "cr√≠ticos" representan el <strong>81%</strong> del peso total en la evaluaci√≥n.
      </p>
    </div>

    <!-- Legend -->
    <div class="legend flex flex-wrap gap-4 mb-8">
      <div class="flex items-center gap-2 text-sm bg-amber-50 border border-amber-200 rounded-lg px-3 py-2">
        <span class="w-3 h-3 bg-amber-400 rounded-full animate-pulse"></span>
        <span class="text-amber-800 font-medium">Pilar cr√≠tico (mayor peso)</span>
      </div>
      <div class="flex items-center gap-2 text-sm bg-slate-50 border border-slate-200 rounded-lg px-3 py-2">
        <span class="w-3 h-3 bg-slate-400 rounded-full"></span>
        <span class="text-slate-600">Pilar complementario</span>
      </div>
    </div>

    <!-- Grid -->
    <div class="pillar-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {pillarData.map((data, index) => {
        const topCandidate = data.topCandidates[0];
        const isCritical = CRITICAL_PILLARS.includes(data.pillar.pillar_id as PillarId);
        
        return (
          <div 
            class={`pillar-item ${isCritical ? 'ring-2 ring-amber-300 rounded-xl shadow-amber-100 shadow-lg' : ''}`}
            style={`--animation-delay: ${index * 0.05}s`}
          >
            <PillarCard
              pillar={data.pillar}
              avgScore={data.avgScore}
              topCandidate={topCandidate ? {
                name: topCandidate.candidate.party_name.split(' ').slice(0, 2).join(' '),
                score: topCandidate.score.effective_score,
              } : undefined}
            />
          </div>
        );
      })}
    </div>

    <!-- Info -->
    <div class="mt-12 card p-6 weight-info">
      <h2 class="text-xl font-bold text-slate-900 mb-4 flex items-center gap-2">
        <span>‚öñÔ∏è</span> Distribuci√≥n de pesos
      </h2>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="bg-amber-50 border border-amber-200 rounded-xl p-4">
          <h3 class="font-semibold text-amber-800 mb-3 flex items-center gap-2">
            <span class="w-3 h-3 bg-amber-400 rounded-full"></span>
            Pilares cr√≠ticos (81%)
          </h3>
          <ul class="text-sm text-amber-700 space-y-2">
            <li class="flex items-center gap-2">üõ°Ô∏è <span><strong>P3 Seguridad:</strong> 18%</span></li>
            <li class="flex items-center gap-2">üè• <span><strong>P4 Salud:</strong> 16%</span></li>
            <li class="flex items-center gap-2">üí∞ <span><strong>P1 Finanzas:</strong> 14%</span></li>
            <li class="flex items-center gap-2">‚öñÔ∏è <span><strong>P7 Reforma:</strong> 12%</span></li>
            <li class="flex items-center gap-2">üíº <span><strong>P2 Empleo:</strong> 11%</span></li>
            <li class="flex items-center gap-2">üìö <span><strong>P5 Educaci√≥n:</strong> 10%</span></li>
          </ul>
        </div>
        <div class="bg-slate-50 border border-slate-200 rounded-xl p-4">
          <h3 class="font-semibold text-slate-800 mb-3 flex items-center gap-2">
            <span class="w-3 h-3 bg-slate-400 rounded-full"></span>
            Pilares complementarios (19%)
          </h3>
          <ul class="text-sm text-slate-600 space-y-2">
            <li class="flex items-center gap-2">üèóÔ∏è <span><strong>P10 Infraestructura:</strong> 9%</span></li>
            <li class="flex items-center gap-2">ü§ù <span><strong>P8 Social:</strong> 5%</span></li>
            <li class="flex items-center gap-2">üåø <span><strong>P6 Ambiente:</strong> 3%</span></li>
            <li class="flex items-center gap-2">üåé <span><strong>P9 Exterior:</strong> 2%</span></li>
          </ul>
        </div>
      </div>
      
      <div class="mt-4 pt-4 border-t border-slate-200 text-center">
        <a href="/metodologia" class="inline-flex items-center gap-2 text-civic-600 hover:text-civic-700 font-medium">
          Ver metodolog√≠a completa
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>
    </div>

  </div>
</BaseLayout>

<style>
  /* Animaci√≥n de entrada */
  .pillar-item {
    animation: slideUp 0.4s ease-out backwards;
    animation-delay: var(--animation-delay);
  }
  
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* ============================================
     MODE: EXPRESS üöÄ (18-35)
     ============================================ */
  :global(html[data-mode="express"]) .pillars-page {
    padding: 1rem;
  }
  
  :global(html[data-mode="express"]) .page-title {
    font-size: 1.75rem;
    text-align: center;
  }
  
  :global(html[data-mode="express"]) .page-description {
    text-align: center;
    font-size: 0.95rem;
  }
  
  :global(html[data-mode="express"]) .legend {
    justify-content: center;
  }
  
  :global(html[data-mode="express"]) .pillar-grid {
    gap: 1rem;
  }
  
  :global(html[data-mode="express"]) .pillar-item {
    border-radius: 1rem;
  }
  
  :global(html[data-mode="express"]) .weight-info {
    border-radius: 1.5rem;
    padding: 1.25rem;
  }

  /* ============================================
     MODE: READING üìñ (50+)
     ============================================ */
  :global(html[data-mode="reading"]) .pillars-page {
    max-width: 56rem;
    padding: 2rem 1.5rem;
  }
  
  :global(html[data-mode="reading"]) .page-title {
    font-size: 2.25rem;
    font-family: Georgia, 'Times New Roman', serif;
  }
  
  :global(html[data-mode="reading"]) .page-description {
    font-size: 1.125rem;
    line-height: 1.8;
  }
  
  :global(html[data-mode="reading"]) .pillar-grid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
  
  :global(html[data-mode="reading"]) .weight-info {
    font-size: 1.125rem;
    padding: 2rem;
  }
  
  :global(html[data-mode="reading"]) .weight-info h2 {
    font-size: 1.5rem;
    font-family: Georgia, 'Times New Roman', serif;
  }
  
  :global(html[data-mode="reading"]) .weight-info ul {
    font-size: 1rem;
    line-height: 2;
  }
</style>

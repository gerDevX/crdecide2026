---
import BaseLayout from '../layouts/BaseLayout.astro';
import PillarGrid from '../components/pillars/PillarGrid.astro';
import QuickRanking from '../components/ranking/QuickRanking.astro';
import ExpressSwiper from '../components/modes/express/ExpressSwiper.astro';
import ReadingRanking from '../components/modes/reading/ReadingRanking.astro';
import { candidates, candidateScores, getRankingWithCandidates, scoresByCandidate, getFiscalStats, analysisByCandidate } from '../lib/data';

// Prepare ranking data for Express and Reading modes
const rankingData = getRankingWithCandidates().map((entry, index) => ({
  candidate: entry.candidate,
  score: scoresByCandidate[entry.candidate_id],
  analysis: analysisByCandidate[entry.candidate_id],
  rank: index + 1,
}));

const fiscalStats = getFiscalStats();
---

<BaseLayout title="Inicio">
  
  <!-- ============================================
       EXPRESS MODE 游
       ============================================ -->
  <div class="mode-express-content">
    <ExpressSwiper candidates={rankingData} />
  </div>

  <!-- ============================================
       DASHBOARD MODE 游늵 (Default)
       ============================================ -->
  <div class="mode-dashboard-content">
    <div class="page-container">
      
      <!-- Hero -->
      <section class="text-center py-12 mb-8">
        <h1 class="text-4xl md:text-5xl font-bold text-slate-900 mb-4">
          Costa Rica <span class="text-gradient">Decide</span> 2026
        </h1>
        <p class="text-xl text-slate-600 max-w-2xl mx-auto mb-8">
          Compara los planes de gobierno de los {candidates.length} candidatos presidenciales.
          <strong>Ahora con an치lisis de responsabilidad fiscal.</strong>
        </p>
        <div class="flex flex-wrap justify-center gap-4">
          <a href="/ranking" class="btn btn-primary py-3 px-6">
            Ver rankings
          </a>
          <a href="/metodologia" class="btn btn-secondary py-3 px-6">
            쮺칩mo funciona?
          </a>
        </div>
      </section>

      <!-- Fiscal Risk Summary -->
      <section class="mb-12">
        <h2 class="dashboard-section-title">
          <span>丘멆잺</span> Riesgo Fiscal de los Planes
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="card p-5 border-l-4 border-green-500">
            <div class="flex items-center justify-between">
              <div>
                <span class="text-3xl font-bold text-green-600">{fiscalStats.lowRisk}</span>
                <p class="text-slate-600 text-sm mt-1">Riesgo Bajo 游릭</p>
              </div>
              <span class="text-4xl opacity-50">游릭</span>
            </div>
            <p class="text-xs text-slate-500 mt-2">No comprometen las finanzas p칰blicas</p>
          </div>
          <div class="card p-5 border-l-4 border-amber-500">
            <div class="flex items-center justify-between">
              <div>
                <span class="text-3xl font-bold text-amber-600">{fiscalStats.mediumRisk}</span>
                <p class="text-slate-600 text-sm mt-1">Riesgo Medio 游</p>
              </div>
              <span class="text-4xl opacity-50">游</span>
            </div>
            <p class="text-xs text-slate-500 mt-2">1-2 banderas fiscales</p>
          </div>
          <div class="card p-5 border-l-4 border-red-500">
            <div class="flex items-center justify-between">
              <div>
                <span class="text-3xl font-bold text-red-600">{fiscalStats.highRisk}</span>
                <p class="text-slate-600 text-sm mt-1">Riesgo Alto 游댮</p>
              </div>
              <span class="text-4xl opacity-50">游댮</span>
            </div>
            <p class="text-xs text-slate-500 mt-2">M칰ltiples banderas fiscales</p>
          </div>
        </div>
        
        <div class="card p-4 mt-4 bg-slate-50 border-slate-200">
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <h3 class="font-semibold text-red-800 mb-2">游댮 Penalizaciones fiscales:</h3>
              <div class="space-y-2 text-sm">
            <div class="flex items-center gap-2">
              <span>丘멆잺</span>
              <span><strong>{fiscalStats.attackFiscalRule}</strong> atacan la regla fiscal</span>
            </div>
            <div class="flex items-center gap-2">
              <span>游눯</span>
              <span><strong>{fiscalStats.proposeDebt}</strong> proponen m치s deuda</span>
            </div>
              </div>
            </div>
            <div>
              <h3 class="font-semibold text-amber-800 mb-2">游 Omisiones de urgencias:</h3>
              <div class="space-y-2 text-sm">
                <div class="flex items-center gap-2">
                  <span>游뚿</span>
                  <span><strong>{fiscalStats.ignoreSecurity}</strong> ignoran seguridad operativa</span>
                </div>
            <div class="flex items-center gap-2">
                  <span>游낀</span>
                  <span><strong>{fiscalStats.ignoreCCSS}</strong> ignoran crisis CCSS</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Stats -->
      <section class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
        <div class="card p-5 text-center">
          <span class="text-3xl font-bold text-gradient">{candidates.length}</span>
          <p class="text-slate-600 text-sm mt-1">Candidatos</p>
        </div>
        <div class="card p-5 text-center">
          <span class="text-3xl font-bold text-gradient">10</span>
          <p class="text-slate-600 text-sm mt-1">Pilares</p>
        </div>
        <div class="card p-5 text-center">
          <span class="text-3xl font-bold text-gradient">6</span>
          <p class="text-slate-600 text-sm mt-1">Tipos de penalizaci칩n</p>
        </div>
        <div class="card p-5 text-center">
          <span class="text-3xl font-bold text-gradient">4</span>
          <p class="text-slate-600 text-sm mt-1">Dimensiones</p>
        </div>
      </section>

      <!-- How it works -->
      <section class="mb-12">
        <h2 class="dashboard-section-title">
          <span>游늵</span> 쮺칩mo evaluamos?
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
          <div class="card p-5">
            <div class="w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center mb-3">
              <span class="text-xl">游늶</span>
            </div>
            <h3 class="font-semibold text-slate-900 mb-1">Existencia</h3>
            <p class="text-sm text-slate-600">쮼s una propuesta concreta?</p>
          </div>
          <div class="card p-5">
            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mb-3">
              <span class="text-xl">游늰</span>
            </div>
            <h3 class="font-semibold text-slate-900 mb-1">Cu치ndo</h3>
            <p class="text-sm text-slate-600">쯊iene plazo definido?</p>
          </div>
          <div class="card p-5">
            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mb-3">
              <span class="text-xl">丘뙖잺</span>
            </div>
            <h3 class="font-semibold text-slate-900 mb-1">C칩mo</h3>
            <p class="text-sm text-slate-600">쮼xplica el mecanismo?</p>
          </div>
          <div class="card p-5">
            <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center mb-3">
              <span class="text-xl">游눯</span>
            </div>
            <h3 class="font-semibold text-slate-900 mb-1">Fondos</h3>
            <p class="text-sm text-slate-600">쯀ndica financiamiento?</p>
          </div>
          <div class="card p-5 bg-red-50 border-red-200">
            <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mb-3">
              <span class="text-xl">丘멆잺</span>
            </div>
            <h3 class="font-semibold text-red-800 mb-1">Penalizaciones</h3>
            <p class="text-sm text-red-600">쮸fecta finanzas p칰blicas?</p>
          </div>
        </div>
      </section>

      <!-- Pillars -->
      <PillarGrid />

      <!-- Quick Ranking -->
      <QuickRanking limit={10} class="mt-12" />

      <!-- CTA -->
      <section class="mt-12 text-center">
        <div class="card p-8 bg-gradient-to-br from-civic-50 to-purple-50 border-civic-200">
          <h2 class="text-2xl font-bold text-slate-900 mb-3">
            쯃isto para comparar?
          </h2>
          <p class="text-slate-600 mb-6">
            Selecciona hasta 4 candidatos y compara sus propuestas lado a lado.
            Ahora puedes ver el riesgo fiscal de cada plan.
          </p>
          <a href="/comparar" class="btn btn-primary py-3 px-8">
            Ir al comparador
          </a>
        </div>
      </section>

    </div>
  </div>

  <!-- ============================================
       READING MODE 游닀
       ============================================ -->
  <div class="mode-reading-content">
    <ReadingRanking candidates={rankingData} currentPage={1} />
  </div>

</BaseLayout>

<style>
  /* Mode visibility */
  .mode-express-content,
  .mode-reading-content {
    display: none;
  }
  
  .mode-dashboard-content {
    display: block;
  }
  
  /* Express mode */
  html[data-mode="express"] .mode-express-content {
    display: block;
  }
  
  html[data-mode="express"] .mode-dashboard-content,
  html[data-mode="express"] .mode-reading-content {
    display: none;
  }
  
  /* Reading mode */
  html[data-mode="reading"] .mode-reading-content {
    display: block;
  }
  
  html[data-mode="reading"] .mode-dashboard-content,
  html[data-mode="reading"] .mode-express-content {
    display: none;
  }
  
  /* Text gradient - Costa Caribe */
  .text-gradient {
    background: linear-gradient(135deg, #0284c7, #06b6d4);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
</style>

---
import type { FiscalRiskLevel, FiscalFlags } from '../../lib/types';
import { PENALTY_LABELS } from '../../lib/types';

interface Props {
  riskLevel: FiscalRiskLevel;
  fiscalFlags?: FiscalFlags;
  showFlags?: boolean;
  size?: 'sm' | 'md' | 'lg';
}

const { riskLevel, fiscalFlags, showFlags = false, size = 'md' } = Astro.props;

const riskConfig = {
  ALTO: {
    emoji: 'ðŸ”´',
    label: 'Riesgo Fiscal ALTO',
    bg: 'bg-red-50',
    border: 'border-red-200',
    text: 'text-red-700',
    ring: 'ring-red-500/20',
  },
  MEDIO: {
    emoji: 'ðŸŸ ',
    label: 'Riesgo Fiscal MEDIO',
    bg: 'bg-amber-50',
    border: 'border-amber-200',
    text: 'text-amber-700',
    ring: 'ring-amber-500/20',
  },
  BAJO: {
    emoji: 'ðŸŸ¢',
    label: 'Riesgo Fiscal BAJO',
    bg: 'bg-green-50',
    border: 'border-green-200',
    text: 'text-green-700',
    ring: 'ring-green-500/20',
  },
};

const config = riskConfig[riskLevel];

const sizeClasses = {
  sm: 'text-xs px-2 py-0.5',
  md: 'text-sm px-3 py-1',
  lg: 'text-base px-4 py-2',
};

// v6: Removed proposes_tax_increase (was ideological bias)
const activeFlags = fiscalFlags ? [
  fiscalFlags.attacks_fiscal_rule && 'attacks_fiscal_rule',
  fiscalFlags.proposes_debt_increase && 'proposes_debt_increase',
].filter(Boolean) as string[] : [];
---

<div class="inline-flex flex-col gap-1">
  <span 
    class:list={[
      'inline-flex items-center gap-1.5 font-semibold rounded-full border',
      config.bg,
      config.border,
      config.text,
      sizeClasses[size],
    ]}
  >
    <span>{config.emoji}</span>
    <span>{riskLevel}</span>
  </span>

  {showFlags && activeFlags.length > 0 && (
    <div class="flex flex-wrap gap-1 mt-1">
      {activeFlags.map(flag => (
        <span 
          class="inline-flex items-center gap-1 text-xs px-2 py-0.5 bg-slate-100 text-slate-600 rounded"
          title={PENALTY_LABELS[flag]?.description}
        >
          <span>{PENALTY_LABELS[flag]?.emoji}</span>
          <span>{PENALTY_LABELS[flag]?.label}</span>
        </span>
      ))}
    </div>
  )}

  {showFlags && fiscalFlags?.shows_fiscal_responsibility && (
    <span class="inline-flex items-center gap-1 text-xs px-2 py-0.5 bg-green-100 text-green-700 rounded mt-1">
      <span>âœ…</span>
      <span>Muestra responsabilidad fiscal</span>
    </span>
  )}
</div>

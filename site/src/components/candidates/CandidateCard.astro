---
import type { Candidate, CandidateScore, PillarId } from '../../lib/types';
import { PILLAR_ICONS } from '../../lib/types';
import ScoreBar from '../ui/ScoreBar.astro';

interface Props {
  candidate: Candidate;
  score: CandidateScore;
  class?: string;
}

const { candidate, score, class: className = '' } = Astro.props;

const weightedSum = score.overall.weighted_sum;
const weightedPercent = Math.round(weightedSum * 100);
---

<a
  href={`/candidatos/${candidate.candidate_id}`}
  class={`card block group ${className}`}
>
  <div class="p-5">
    <div class="flex items-start justify-between mb-3">
      <div>
        <span class="text-xs font-medium text-slate-400 uppercase">{candidate.pdf_id}</span>
        <h3 class="font-semibold text-slate-900 group-hover:text-civic-600 transition-colors">
          {candidate.party_name}
        </h3>
      </div>
      <div class="text-right">
        <span class="text-2xl font-bold text-civic-600">{weightedPercent}%</span>
      </div>
    </div>
    
    <!-- Mini matrix -->
    <div class="grid grid-cols-10 gap-1 mb-3">
      {score.pillar_scores.map((ps) => {
        const icon = PILLAR_ICONS[ps.pillar_id as PillarId];
        const opacity = ps.effective_score / 4;
        return (
          <div
            class="aspect-square rounded flex items-center justify-center text-xs"
            style={`background-color: rgba(16, 185, 129, ${opacity * 0.7 + 0.1})`}
            title={`${ps.pillar_id}: ${ps.effective_score}/4`}
          >
            <span class="opacity-70">{icon}</span>
          </div>
        );
      })}
    </div>
    
    <ScoreBar score={Math.round(weightedSum * 4)} max={4} showLabel={false} size="sm" />
    
    <div class="mt-3 text-xs text-slate-500">
      {score.pillar_scores.filter(ps => ps.effective_score === 4).length} pilares con puntaje m√°ximo
    </div>
  </div>
</a>

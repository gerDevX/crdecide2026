---
import type { CandidateScore, PillarId } from '../../lib/types';
import { PILLAR_ICONS, CRITICAL_PILLARS } from '../../lib/types';
import { pillarIndex } from '../../lib/data';
import ScoreBar from '../ui/ScoreBar.astro';
import DimensionBadges from '../ui/DimensionBadges.astro';

interface Props {
  score: CandidateScore;
  showDetail?: boolean;
  class?: string;
}

const { score, showDetail = false, class: className = '' } = Astro.props;
---

<div class={`space-y-3 ${className}`}>
  {score.pillar_scores.map((ps) => {
    const pillar = pillarIndex[ps.pillar_id];
    const icon = PILLAR_ICONS[ps.pillar_id as PillarId];
    const isCritical = CRITICAL_PILLARS.includes(ps.pillar_id as PillarId);
    
    return (
      <div class={`card p-4 border-l-4 pillar-${ps.pillar_id}`}>
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-2">
            <span class="text-lg">{icon}</span>
            <span class="font-medium text-slate-900">{pillar.pillar_name}</span>
            {isCritical && (
              <span class="text-xs bg-amber-100 text-amber-700 px-1.5 py-0.5 rounded">Crítico</span>
            )}
          </div>
          <span class="font-bold text-slate-700">{ps.effective_score}/4</span>
        </div>
        
        <ScoreBar score={ps.effective_score} max={4} showLabel={false} size="md" />
        
        {showDetail && (
          <div class="mt-3 pt-3 border-t border-slate-100">
            <DimensionBadges dimensions={ps.dimension_counts} compact={false} />
            
            {ps.penalties.length > 0 && (
              <div class="mt-2 text-xs text-red-600 bg-red-50 px-2 py-1 rounded">
                ⚠️ {ps.penalties[0].reason}
              </div>
            )}
          </div>
        )}
      </div>
    );
  })}
</div>

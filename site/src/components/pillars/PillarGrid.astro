---
import PillarCard from './PillarCard.astro';
import { getAllPillarCardData, candidateIndex, pillars } from '../../lib/data';
import { PRIORITY_PILLARS } from '../../lib/types';
import type { PillarId } from '../../lib/types';

const pillarData = getAllPillarCardData();

// Sort pillars by weight (priority order)
const sortedPillarData = [...pillarData].sort((a, b) => 
  (b.pillar?.weight || 0) - (a.pillar?.weight || 0)
);
---

<section class="py-4">
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
    {sortedPillarData.map((data, index) => {
      const isPriority = data.pillar && PRIORITY_PILLARS.includes(data.pillar.pillar_id as PillarId);
      
      // Get top 5 candidates with full info
      const top5Candidates = data.topCandidates.slice(0, 5).map(tc => ({
        name: tc.candidate?.party_name || 'N/A',
        candidateName: tc.candidate?.candidate_name !== 'Por determinar' && tc.candidate?.candidate_name !== 'no_especificado'
          ? tc.candidate?.candidate_name
          : undefined,
        score: tc.score.effective_score,
        id: tc.candidate?.candidate_id || '',
      }));
      
      return (
        <PillarCard
          pillar={data.pillar}
          avgScore={data.avgScore}
          topCandidates={top5Candidates}
          isPriority={isPriority}
          rank={index + 1}
        />
      );
    })}
  </div>
  
  <div class="mt-6 flex flex-wrap items-center justify-between gap-4">
    <div class="flex items-center gap-4 text-sm text-slate-500">
      <span class="flex items-center gap-2">
        <span class="w-3 h-3 bg-gradient-to-r from-red-400 to-rose-500 rounded"></span>
        <span>Prioritarios (60% del peso)</span>
      </span>
      <span class="flex items-center gap-2">
        <span class="w-3 h-3 bg-gradient-to-r from-cyan-400 to-blue-500 rounded"></span>
        <span>Est√°ndar</span>
      </span>
    </div>
    <a 
      href="/pilares" 
      class="inline-flex items-center gap-1 text-sm font-semibold text-cyan-600 hover:text-cyan-700 transition-colors group"
    >
      Ver todos los pilares
      <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
      </svg>
    </a>
  </div>
</section>

---
import PillarCard from './PillarCard.astro';
import { getAllPillarCardData, candidateIndex, pillars } from '../../lib/data';
import { PRIORITY_PILLARS } from '../../lib/types';
import type { PillarId } from '../../lib/types';

const pillarData = getAllPillarCardData();

// Sort pillars by weight (priority order)
const sortedPillarData = [...pillarData].sort((a, b) => 
  (b.pillar?.weight || 0) - (a.pillar?.weight || 0)
);
---

<section class="py-8">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h2 class="text-2xl font-bold text-slate-900">Los 10 Pilares Nacionales</h2>
      <p class="text-sm text-slate-500 mt-1">Ordenados por prioridad según las urgencias de Costa Rica</p>
    </div>
    <a href="/pilares" class="text-civic-600 hover:text-civic-700 text-sm font-medium">
      Ver todos →
    </a>
  </div>
  
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
    {sortedPillarData.map((data, index) => {
      const topCandidate = data.topCandidates[0];
      const isPriority = data.pillar && PRIORITY_PILLARS.includes(data.pillar.pillar_id as PillarId);
      
      return (
        <PillarCard
          pillar={data.pillar}
          avgScore={data.avgScore}
          topCandidate={topCandidate ? {
            name: topCandidate.candidate?.party_name?.split(' ').slice(0, 2).join(' ') || 'N/A',
            score: topCandidate.score.effective_score,
          } : undefined}
          isPriority={isPriority}
          rank={index + 1}
        />
      );
    })}
  </div>
  
  <div class="mt-4 text-sm text-slate-500 flex items-center gap-4">
    <span class="flex items-center gap-1">
      <span class="w-3 h-3 bg-red-100 rounded"></span>
      <span>Prioritarios (60% del peso)</span>
    </span>
    <span class="flex items-center gap-1">
      <span class="w-3 h-3 bg-amber-100 rounded"></span>
      <span>Críticos</span>
    </span>
  </div>
</section>
